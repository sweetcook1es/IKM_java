<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Печенька.ru</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark mb-4">
    <div class="container">
        <a class="navbar-brand" href="/admin/products">
            <i class="bi bi-arrow-left"></i> Назад к списку
        </a>
    </div>
</nav>

<div class="container">
    <div class="form-container">
        <div class="text-center mb-5">
            <h1 class="text-gray-900">
                <i class="bi bi-box-seam"></i>
                <span th:if="${product.id != null}">Редактирование товара</span>
                <span th:unless="${product.id != null}">Добавление нового товара</span>
            </h1>
            <p class="text-gray-500">
                <span th:if="${product.id != null}">Изменение данных о товаре</span>
                <span th:unless="${product.id != null}">Добавление нового вида печенья в ассортимент</span>
            </p>
        </div>

        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-box"></i> Основная информация
                </h5>
            </div>
            <div class="card-body">
                <form th:action="${product.id != null ?
                                 '/admin/products/' + product.id :
                                 '/admin/products'}"
                      method="post" th:object="${product}">

                    <!-- ID товара (только для редактирования) -->
                    <div th:if="${product.id != null}" class="mb-3">
                        <label class="form-label text-gray-500">ID товара</label>
                        <input type="text" class="form-control bg-light"
                               th:value="${product.id}" readonly>
                    </div>

                    <!-- Название товара -->
                    <div class="mb-3">
                        <label for="name" class="form-label required-field">Название товара</label>
                        <input type="text" class="form-control" id="name"
                               th:field="*{name}"
                               placeholder="Например: Песочное печенье с шоколадом"
                               required>
                        <div class="form-text text-gray-500">
                            Укажите полное название товара
                        </div>
                    </div>

                    <!-- Описание -->
                    <div class="mb-3">
                        <label for="description" class="form-label">Описание</label>
                        <textarea class="form-control" id="description"
                                  th:field="*{description}"
                                  rows="3"
                                  placeholder="Опишите товар..."></textarea>
                        <div class="form-text text-gray-500">
                            Необязательное поле для подробного описания
                        </div>
                    </div>

                    <!-- Цена -->
                    <div class="mb-3">
                        <label for="price" class="form-label required-field">Цена (₽)</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="price"
                                   th:field="*{price}"
                                   step="0.01" min="0"
                                   placeholder="0.00"
                                   required>
                            <span class="input-group-text">₽</span>
                        </div>
                        <div class="form-text text-gray-500">
                            Укажите цену товара в рублях
                        </div>
                    </div>

                    <!-- Категория -->
                    <div class="mb-4">
                        <label for="category" class="form-label required-field">Категория</label>
                        <select class="form-select" id="category"
                                th:field="*{category.id}"
                                required>
                            <!-- Убрать опцию "Без категории" -->
                            <!-- <option value="">Без категории</option> -->
                            <option value="" disabled selected>Выберите категорию</option>
                            <option th:each="cat : ${categories}"
                                    th:value="${cat.id}"
                                    th:text="${cat.name}">
                            </option>
                        </select>
                        <div class="form-text text-gray-500">
                            Выберите категорию товара (обязательно)
                        </div>
                    </div>

                    <!-- Кнопки формы -->
                    <div class="d-flex justify-content-between">
                        <a href="/admin/products" class="btn btn-secondary">
                            <i class="bi bi-x-circle"></i> Отмена
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-save"></i>
                            <span th:if="${product.id != null}">Сохранить изменения</span>
                            <span th:unless="${product.id != null}">Добавить товар</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<footer class="footer">
    <div class="container text-center">
        <p class="mb-0">© 2026 Печенька.ru - Система управления</p>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/app.js}"></script>
<script>
    // Валидация формы на клиенте
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('form');
        const requiredFields = form.querySelectorAll('[required]');

        form.addEventListener('submit', function(e) {
            let isValid = true;

            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('is-invalid');
                    isValid = false;
                } else {
                    field.classList.remove('is-invalid');
                }
            });

            if (!isValid) {
                e.preventDefault();
                alert('Пожалуйста, заполните все обязательные поля');
            }
        });

        // Удаление класса is-invalid при вводе
        requiredFields.forEach(field => {
            field.addEventListener('input', function() {
                if (this.value.trim()) {
                    this.classList.remove('is-invalid');
                }
            });
        });
    });
</script>
</body>
</html>